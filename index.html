<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>Systemsim</title>
    <style>
      *, *::before, *::after {
        box-sizing: border-box;
      }
      * {
        margin: 0;
        font-family: 'Courier New', monospace;
      }
      body {
        color: white;
        background-color: black;
      }
      #terminal {
        font-size: 12px;
      }
    </style>
    <script>
      class Game {
        terminalBuffer = [];
        prompt = '';
        input = '';
        inputElem = document.createElement('input');
        state = 'init';
        terminalState = 'output';

        constructor() {}

        openFullscreen() {
          // https://www.w3schools.com/howto/howto_js_fullscreen.asp
          console.debug("Opening fullscreen");
          if (document.requestFullscreen) {
            document.requestFullscreen();
          } else if (document.webkitRequestFullscreen) { /* Safari */
            document.webkitRequestFullscreen();
          } else if (document.msRequestFullscreen) { /* IE11 */
            document.msRequestFullscreen();
          }
        }

        refresh() {
          switch (game.state) {
            case 'init':
              if (game.terminalState === 'output') {
                game.prompt = 'You are sitting at your desk, in front of your home computer. It is currently shut down.<br />Possible actions: [boot inspect stand]<br />Action: ';
                game.terminalState = 'input';
              }
              break;
            case 'boot':
              break;
            case 'inspect':
              break;
            case 'stand':
              break;
          }

          if (game.terminalState === 'exec') {
            game.terminalBuffer.push(game.prompt + game.input + '<br />');
            game.prompt = '';
            game.input = '';
            game.terminalState = 'output';
          }

          document.getElementById('terminal').innerHTML = game.terminalBuffer.join('') + game.prompt + game.input;
        }
      }

      const game = new Game();

      document.addEventListener("DOMContentLoaded", () => {
        game.openFullscreen();
        game.refresh();
      });

      document.addEventListener("keypress", (e) => {
        if (e.key === 'Enter') {
          game.terminalState = 'exec';
        } else {
          const kev = new KeyboardEvent('keypress', { ...e });
          game.inputElem.value = game.input;
          game.inputElem.dispatchEvent(kev);
          game.input = game.inputElem.value;
        }
        game.refresh();
      });
    </script>
  </head>
  <body id="terminal">
  </body>
</html>
